<?xml version="1.0" encoding="UTF-8"?>
<!--suppress XmlDefaultAttributeValue -->
<thing:thing-descriptions bindingId="argoclima"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:thing="https://openhab.org/schemas/thing-description/v1.0.0"
	xsi:schemaLocation="https://openhab.org/schemas/thing-description/v1.0.0 https://openhab.org/schemas/thing-description-1.0.0.xsd">

	<thing-type id="argoclima">
		<label>ArgoClima A/C - local</label>
		<description><![CDATA[ArgoClima Ulisse Eco 13-compatible Air Conditioner <i>(local LAN connection)</i>
		<br/>
		Independent mode - does not require Internet connectivity (see <b>connectionMode</b> advanced setting for more options).
		]]></description>
		<category>HVAC</category>

		<channel-groups>
			<channel-group id="acControls" typeId="acControls-group"/>
			<channel-group id="modes" typeId="modes-group"/>
			<channel-group id="timers" typeId="timers-group"/>
			<channel-group id="unsupported" typeId="unsupported-group"/>
			<channel-group id="settings" typeId="settings-group"/>
		</channel-groups>


		<properties>
			<property name="vendor">ArgoClima</property>
			<property name="modelId">Ulisse Eco 13 DCI - compatible device</property>
			<property name="protocol">WiFi - local network</property> <!--TODO (maybe update dynamically: https://www.openhab.org/docs/developer/bindings/thing-handler.html) -->

			<!--
				public static final String PROPERTY_CPU_ID = "cpuId";
				public static final String PROPERTY_LOCAL_IP_ADDRESS = "localIpAddress";
				public static final String PROPERTY_UNIT_FW = "unitFirmwareVersion";
				public static final String PROPERTY_WIFI_FW= "wifiFirmwareVersion"; -->
		</properties>

		<representation-property>hostname</representation-property>

		<config-description>
			<parameter-group name="connection">
				<label>Connection</label>
				<description>Connection settings.</description>
			</parameter-group>
			<parameter-group name="serverStub">
				<label>Argo server stub</label>
				<description><![CDATA[Configuration of OpenHab acting as Argo API server (requires proxying device-side traffic to this OH instance).
                <i>These settings are effective only for <code>REMOTE_API_STUB | REMOTE_API_PROXY</code> connection modes.</i>
                ]]></description>
			</parameter-group>
            <!-- Note: dynamic parameters are also in use (see ArgoClimaConfigProvider) -->

			<parameter name="hostname" type="text" required="true" readOnly="false" groupName="connection">
				<context>network-address</context>
				<label>Hostname</label>
				<description><![CDATA[Hostname or IP address of the HVAC device.<br/><i>If <b>useLocalConnection</b> setting is <b>enabled</b>, this address will be used for (command push + status polling) communication with the device.</i>]]></description>
			</parameter>

            <parameter name="localDevicePort" type="integer" min="0" max="65536" required="true" groupName="serverStub">
                <label>Device API listen port</label>
                <description><![CDATA[Port at which the local device listens on.<br/>
                <i>This setting is effective only if <code>Use Local Connection</code> is <code>true</code>. The default value 1001 is hard-coded in Argo Firmware. You would only need to override it if the device is behind NAT, and you have configured a custom port forwarding rule using port other than 1001</i>
                ]]>
                </description>
                <default>1001</default>
                <advanced>true</advanced>
            </parameter>
            
			<parameter name="localDeviceIP" type="text" required="false" readOnly="false" groupName="connection">
				<context>network-address</context>
				<label>Local IP address (behind NAT)</label>
				<description><![CDATA[Local IP address of the device in its local subnet (may be different from <b>hostname</b>, if behind NAT).<br/>
					Optional, value is used for detecting device-side updates in one of the <code>REMOTE</code> modes.]]></description>
				<advanced>true</advanced>
			</parameter>

			<parameter name="deviceCpuId" type="text" required="false" readOnly="false" groupName="connection">
				<label>CPU ID</label>
				<description>CPU ID of the device. Optional, value is used for detecting device update in proxy mode.</description>
				<advanced>true</advanced>
			</parameter>

			<parameter name="connectionMode" type="text" required="true" groupName="connection">
				<label>Connection mode</label>
				<description><![CDATA[Type of connection to use.<br/>
                <b>- <code>LOCAL_CONNECTION</code></b> - Directly communicates with the AC device over LAN (default mode).<br/>
                <b>- <code>REMOTE_API_STUB</code></b> - OpenHab simulates vendor's remote server <i>(most functionality implemented, w/o FW update support)</i>. Requires traffic from the AC re-routed to this OH instance (network-level configuration, see README). Allows <u>full-local control</u> (w/o Internet access to the device). Can also control units which are not directly reachable over LAN, e.g. behind NAT (set <code>Local IP address</code>).<br />
                <b>- <code>REMOTE_API_PROXY</code></b> - OpenHab behaves as a proxy to the remote Manufacturer's server (injects OH-side commands). Allows to still use the Vendor's application. WARNING: This mode (similarly to using vanilla Argo WebApp) may be considered insecure <i>(plain HTTP communications, passwords transmitted in the clear, unsigned FW updates...)</i>.<br />
                ]]>
				</description>
				<default>LOCAL_CONNECTION</default>
				<options>
					<option value="LOCAL_CONNECTION">LOCAL_CONNECTION - Local only (no remote server stub). (**Default**)</option>
					<option value="REMOTE_API_STUB">REMOTE_API_STUB - OpenHab as ArgoClima server stub. [Advanced] (**Recommended**)</option>
					<option value="REMOTE_API_PROXY">REMOTE_API_PROXY - OpenHab as ArgoClima server w/ pass-through to OEM app. [Advanced]</option>
				</options>
				<advanced>true</advanced>
			</parameter>

			<parameter name="useLocalConnection" type="boolean" required="true" groupName="connection">
				<label>Use Local Connection</label>
				<description><![CDATA[If enabled, will directly communicate with the device to send commands and poll for its status.<br/>
				Must be enabled for <code>LOCAL_CONNECTION</code> mode. If disabled (in any of the <code>REMOTE_*</code> connection modes), no push communication will be initiated from OH-side, and commands will be sent on next device-side poll cycle (possible delay)]]></description>
				<default>true</default>
				<advanced>true</advanced>
			</parameter>

			<parameter name="refreshInterval" type="integer" unit="s" min="0" groupName="connection" required="true" >
				<label>Refresh Interval</label>
				<description><![CDATA[Interval the device is polled in seconds. This setting is only effective if <code>Use Local Connection</code> is <code>ON</code>.<br/>
                Set to <code>0</code> to disable polling (requires any of <code>REMOTE_*</code> connection modes)]]></description>
				<default>30</default>
				<advanced>true</advanced>
			</parameter>

			<parameter name="stubServerPort" type="integer" min="0" max="65536" required="false" groupName="serverStub">
				<label>Stub server listen port</label>
				<description><![CDATA[Port at which the Stub server will listen on.<br/>
                <i>This setting is effective only for <code>REMOTE_*</code> connection modes</i>
                ]]>
				</description>
				<default>8239</default>
				<advanced>true</advanced>
			</parameter>

			<parameter name="stubServerListenAddresses" type="text" multiple="true" groupName="serverStub">
				<context>network-address</context>
				<label>Stub server listen interfaces</label>
				<description><![CDATA[List of interfaces the stub server will listen on<br/>
                <i>This setting is effective only for <code>REMOTE_API_STUB | REMOTE_API_PROXY</code> connection modes</i>
                ]]>
				</description>
				<default>0.0.0.0</default>
				<advanced>true</advanced>
			</parameter>

            <parameter name="oemServerAddress" type="text" groupName="serverStub">
                <context>network-address</context>
                <label>Argo remote server address</label>
                <description><![CDATA[The OEM server's port, used to pass through the communications to. <br/>
                <i>This setting is effective only for <code>REMOTE_API_PROXY</code> connection mode</i>
                ]]>
                </description>
                <default>31.14.128.210</default>
                <advanced>true</advanced>
            </parameter>
            
			<parameter name="oemServerPort" type="integer" min="0" max="65536" required="false" groupName="serverStub">
				<label>Argo remote server port</label>
				<description><![CDATA[The OEM server's port, used to pass through the communications to<br/>
                <i>This setting is effective only for <code>REMOTE_API_PROXY</code> connection mode</i>
                ]]>
				</description>
				<default>80</default>
				<advanced>true</advanced>
			</parameter>
		</config-description>
	</thing-type>

	<thing-type id="argoclima-remote">
		<label>ArgoClima A/C - remote</label>
		<description><![CDATA[ArgoClima Ulisse Eco 13-compatible Air Conditioner <i>(remote connection via Argo servers)</i>
		<br/>
		<i>Requires Internet connectivity for <b>both</b> OpenHab and the HVAC device separately.</i>
		]]></description>
		<category>HVAC</category>
		<channel-groups>
			<channel-group id="acControls" typeId="acControls-group"/>
			<channel-group id="modes" typeId="modes-group"/>
			<channel-group id="timers" typeId="timers-group"/>
			<channel-group id="unsupported" typeId="unsupported-group"/>
			<channel-group id="settings" typeId="settings-group"/>
		</channel-groups>

		<properties>
			<property name="vendor">ArgoClima</property>
			<property name="modelId">Ulisse Eco 13 DCI - compatible device</property>
			<property name="protocol">Remote connection</property> <!--TODO (maybe update dynamically: https://www.openhab.org/docs/developer/bindings/thing-handler.html) -->
		</properties>

		<representation-property>username</representation-property>

		<config-description>
			<parameter-group name="connection">
				<label>Connection</label>
				<description>Connection settings.</description>
			</parameter-group>
			<parameter-group name="oemServerConnection"> <!-- TODO: rename from serverStub -> OEM sth? -->
				<label>Argo server connection details</label>
				<description><![CDATA[Configuration of Argo remote server.]]></description>
			</parameter-group>

			<parameter name="username" type="text" required="true" readOnly="false" groupName="connection">
				<label>Username</label>
				<description>Username</description>
			</parameter>

			<parameter name="password" type="text" required="true" groupName="connection">
				<context>password</context>
				<label>Password</label>
				<description>Password to access the device</description>
			</parameter>

			<parameter name="refreshInterval" type="integer" unit="s" min="10" required="true" groupName="connection">
				<label>Refresh Interval</label>
				<description><![CDATA[Interval the vendor device API is polled in <i>(in seconds)</i>.]]></description>
				<default>30</default>
				<advanced>true</advanced>
			</parameter>

            <parameter name="oemServerAddress" type="text" required="true" groupName="oemServerConnection" >
                <context>network-address</context>
                <label>Argo remote server address</label>
                <description><![CDATA[The OEM server's hostname, used for communications.<br/>
                <i>This is the same host as for the Web Application (address provided in device's user manual).</i>
                ]]>
                <!-- <br/>
                Note: <i>The address seems to be: uisetup.ddns.net</i> -->
                </description>
                <default>31.14.128.210</default>
                <advanced>true</advanced>
            </parameter>
            
			<parameter name="oemServerPort" type="integer" min="0" max="65536" required="true" groupName="oemServerConnection">
				<label>Argo remote server port</label>
				<description><![CDATA[The OEM server's port. <i>Default 80.</i>]]>
				</description>
				<default>80</default>
				<advanced>true</advanced>
			</parameter>
		</config-description>
	</thing-type>

	<channel-group-type id="acControls-group">
		<label>A/C Controls</label>
		<category>HVAC</category>
		<channels>
			<channel id="power" typeId="system.power"/>
			<channel id="mode" typeId="modeBasic-channel"/>
			<channel id="setTemperature" typeId="setTemperature-channel"/>
			<channel id="currentTemperature" typeId="system.indoor-temperature"/>
			<channel id="fanSpeed" typeId="fanSpeed-channel"/>
		</channels>
	</channel-group-type>

	<channel-group-type id="modes-group">
		<label>Operation Modes</label>
		<channels>
			<channel id="ecoMode" typeId="ecoModeModifier-channel">
				<label>Eco Mode</label>
			</channel>
			<channel id="turboMode" typeId="turboModeModifier-channel">
				<label>Turbo Mode</label>
			</channel>
			<channel id="nightMode" typeId="nightModeModifier-channel">
				<label>Night Mode</label>
			</channel>
		</channels>
	</channel-group-type>

	<channel-group-type id="timers-group">
		<label>Timers</label>
		<category>Time</category>
		<channels>
			<channel id="activeTimer" typeId="activeTimer-channel"/>
			<channel id="delayTimer" typeId="delayTimer-channel"/>
		</channels>
	</channel-group-type>

	<channel-group-type id="unsupported-group">
		<label>Unsupported modes</label>
		<description><![CDATA[These channels are available on the original Argo remote (and app), but the Ulisse DCI device does not support it.]]></description>
		<channels>
			<channel id="modeEx" typeId="modeExtended-channel"/>
			<channel id="swingMode" typeId="swingMode-channel"/>
			<channel id="filterMode" typeId="filterModeModifier-channel">
				<label>Filter Mode</label>
			</channel>
		</channels>
	</channel-group-type>

	<channel-group-type id="settings-group">
		<label>Settings</label>
		<!--<description></description>
			<category></category> -->
		<channels>
			<channel id="iFeelEnabled" typeId="iFeel-channel"/>
			<channel id="deviceLights" typeId="deviceLights-channel"/>
			<channel id="temperatureDisplayUnit" typeId="temperatureDisplayUnit-channel"/>
			<channel id="ecoPowerLimit" typeId="ecoPowerLimit-channel"/>
		</channels>
	</channel-group-type>


	<!--
		*** CHANNELS ***
	-->
	<channel-type id="modeBasic-channel">
		<item-type>String</item-type>
		<label>Mode</label> <!-- Use uppercase words, except prepositions. 2-3 words, max 25 chars -->
		<category>Climate</category>
		<tags>
		      <tag>Control</tag>
		      <tag>Climate</tag>
		</tags>
		<state readOnly="false">
			<options>
				<option value="COOL">Cool</option>
				<!--<option value="HEAT">Heat</option> -->
				<option value="DRY">Dry</option>
				<option value="FAN">Fan</option>
				<option value="AUTO">Auto</option>
			</options>
		</state>
	</channel-type>

	<channel-type id="setTemperature-channel">
		<item-type>Number:Temperature</item-type>
		<label>Set Temperature</label><!-- Use uppercase words, except prepositions. 2-3 words, max 25 chars -->
		<description>The device's target temperature</description>
		<category>Temperature</category>
		<tags>
			<tag>Setpoint</tag>
			<tag>Temperature</tag>
		</tags>
		<state min="10" max="32" step="0.1" pattern="%.1f %unit%" readOnly="false"/>
	</channel-type>

	<channel-type id="currentTemperature-channel">
		<item-type>Number:Temperature</item-type>
		<label>Actual temperature</label>
		<category>Temperature</category>
		<tags>
			<tag>Measurement</tag>
			<tag>Temperature</tag>
		</tags>
		<state readOnly="true" pattern="%.1f %unit%"/>
	</channel-type>

	<channel-type id="fanSpeed-channel">
		<item-type>String</item-type>
		<!-- todo: string or number? -->
		<label>Fan speed</label>
		<category>Fan</category>
		<state readOnly="false">
			<options>
				<option value="AUTO">AUTO</option>
				<option value="LEVEL_1">Level 1</option>
				<option value="LEVEL_2">Level 2</option>
				<option value="LEVEL_3">Level 3</option>
				<option value="LEVEL_4">Level 4</option>
				<option value="LEVEL_5">Level 5</option>
				<option value="LEVEL_6">Level 6</option>
			</options>
		</state>
	</channel-type>


	<channel-type id="ecoModeModifier-channel">
		<item-type>Switch</item-type>
		<label>Eco Mode</label>
		<category>Vacation</category>
		<state readOnly="false"/>
	</channel-type>

	<channel-type id="turboModeModifier-channel">
		<item-type>Switch</item-type>
		<label>Turbo Mode</label>
		<category>Party</category>
		<state readOnly="false"/>
	</channel-type>

	<channel-type id="filterModeModifier-channel" advanced="true">
		<item-type>Switch</item-type>
		<label>Filter Mode</label>
		<category>Switch</category>
		<state readOnly="false"/>
	</channel-type>

	<channel-type id="nightModeModifier-channel">
		<item-type>Switch</item-type>
		<label>Night Mode</label>
		<category>Moon</category>
		<state readOnly="false"/>
	</channel-type>

	<channel-type id="activeTimer-channel" advanced="true">
		<item-type>String</item-type>
		<label>Active timer</label>
        <category>Calendar</category>
		<state readOnly="false">
			<options>
				<option value="NO_TIMER">No Timer</option>
				<option value="DELAY_TIMER">Delay Timer</option>
				<option value="SCHEDULE_TIMER_1">Schedule Timer 1</option>
				<option value="SCHEDULE_TIMER_2">Schedule Timer 2</option>
				<option value="SCHEDULE_TIMER_3">Schedule Timer 3</option>
			</options>
		</state>
	</channel-type>

	<channel-type id="delayTimer-channel" advanced="true">
		<item-type>Number:Time</item-type>
		<label>Delay timer value</label>
        <category>Time</category>
        
		<!-- remote: min: 0:10 <> max 19:50h -->
		<!-- TODO: nice HH:MM display format -->
		<state readOnly="false" min="10" max="1190" step="10.0"/>
	</channel-type>



	<channel-type id="modeExtended-channel" advanced="true">
		<item-type>String</item-type>
		<label>Extended Mode</label> <!-- Use uppercase words, except prepositions. 2-3 words, max 25 chars -->
        <category>Heating</category>
		<state readOnly="false">
			<options>
				<option value="COOL">Cool</option>
				<option value="WARM">Heat</option>
				<option value="DRY">Dry</option>
				<option value="FAN">Fan</option>
				<option value="AUTO">Auto</option>
			</options>
		</state>
	</channel-type>

	<channel-type id="swingMode-channel" advanced="true">
		<!-- <item-type>Number:Dimensionless</item-type> -->
		<item-type>String</item-type>
		<!-- todo: string or number? -->
		<label>Airflow Direction</label>
		<category>Flow</category>
		<state readOnly="false">
			<options>
				<option value="AUTO">Swing</option>
				<option value="LEVEL_1">Swing - Upper Half</option>
				<option value="LEVEL_2">Static - Lowest</option>
				<option value="LEVEL_3">Static - Low</option>
				<option value="LEVEL_4">Static - Mid-low</option>
				<option value="LEVEL_5">Static - Mid-high</option>
				<option value="LEVEL_6">Static - High</option>
				<option value="LEVEL_7">Static - Highest</option>
			</options>
		</state>
	</channel-type>

	<channel-type id="iFeel-channel">
		<item-type>Switch</item-type>
		<label>Use iFeel Temperature</label>
		<category>Network</category>
		<state readOnly="false"/>
	</channel-type>

	<channel-type id="deviceLights-channel">
		<item-type>Switch</item-type>
		<label>Device Lights</label>
		<category>Light</category>
		<state readOnly="false"/>
	</channel-type>

	<channel-type id="temperatureDisplayUnit-channel" advanced="true">
		<item-type>String</item-type>
		<label>Temperature Display Unit</label>
		<category>Settings</category>
		<state readOnly="false">
			<options>
				<option value="SCALE_CELSCIUS">Degrees Celscius</option>
				<option value="SCALE_FARHENHEIT">Fahrenheit</option>
			</options>
		</state>
	</channel-type>

	<channel-type id="ecoPowerLimit-channel" advanced="true">
		<item-type>Number:Dimensionless</item-type>
		<label>Power limit in eco mode</label>
        <category>Price</category>
		<state readOnly="false" min="30" max="99" step="1" pattern="%.0f %%"/>
	</channel-type>

</thing:thing-descriptions>
